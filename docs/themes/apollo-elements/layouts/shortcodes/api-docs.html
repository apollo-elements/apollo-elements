{{- $package := .Get "package" | default "" -}}
{{- $element := .Get "element" | default "" -}}
{{- $type := .Get "type" | default "element" -}}
{{- $section := .Get "section" | default "overview" -}}

<!-- API Documentation Component -->
<div class="api-docs-container" data-package="{{ $package }}" data-element="{{ $element }}">

  {{ if eq $type "element" }}
    <!-- Custom Element Documentation -->
    <div class="custom-element-docs">
      {{ if $element }}
        <!-- Element Header -->
        <header class="element-header">
          <h2 class="element-name">
            <code>&lt;{{ $element }}&gt;</code>
          </h2>

          <!-- Element meta info from manifest -->
          <div class="element-meta">
            <span class="element-package">{{ $package }}</span>
            {{ with .Get "since" }}
              <span class="element-since">Since v{{ . }}</span>
            {{ end }}
          </div>
        </header>

        <!-- Element Description -->
        {{ with .Get "description" }}
          <div class="element-description">
            <p>{{ . | markdownify }}</p>
          </div>
        {{ end }}

        <!-- Usage Example -->
        {{ if .Inner }}
          <div class="element-usage">
            <h3>Usage</h3>
            <div class="code-example">
              {{ .Inner }}
            </div>
          </div>
        {{ end }}

        <!-- Properties Section -->
        {{ if eq $section "properties" }}
          <div class="element-properties">
            <h3>Properties</h3>
            <type-doc kind="property" data-property="{{ $element }}">
              {{ partial "cem/type-doc-dsd.html" . }}
              <p>Loading properties documentation...</p>
            </type-doc>
          </div>
        {{ end }}

        <!-- Events Section -->
        {{ if eq $section "events" }}
          <div class="element-events">
            <h3>Events</h3>
            <type-doc kind="event" data-event="{{ $element }}">
              {{ partial "cem/type-doc-dsd.html" . }}
              <p>Loading events documentation...</p>
            </type-doc>
          </div>
        {{ end }}

        <!-- Methods Section -->
        {{ if eq $section "methods" }}
          <div class="element-methods">
            <h3>Methods</h3>
            <type-doc kind="method" data-method="{{ $element }}">
              {{ partial "cem/type-doc-dsd.html" . }}
              <p>Loading methods documentation...</p>
            </type-doc>
          </div>
        {{ end }}

        <!-- CSS Custom Properties -->
        {{ if eq $section "css-props" }}
          <div class="element-css-props">
            <h3>CSS Custom Properties</h3>
            <css-value-doc package="{{ $package }}" element="{{ $element }}">
              <p>Loading CSS properties documentation...</p>
            </css-value-doc>
          </div>
        {{ end }}

        <!-- Slots Section -->
        {{ if eq $section "slots" }}
          <div class="element-slots">
            <h3>Slots</h3>
            <type-doc kind="slot" data-slot="{{ $element }}">
              {{ partial "cem/type-doc-dsd.html" . }}
              <p>Loading slots documentation...</p>
            </type-doc>
          </div>
        {{ end }}

        <!-- Complete API Overview -->
        {{ if eq $section "overview" }}
          <div class="element-overview">
            <div class="api-section">
              <h3>Properties</h3>
              <type-doc kind="property" data-property="{{ $element }}">
                {{ partial "cem/type-doc-dsd.html" . }}
                <p>Loading properties...</p>
              </type-doc>
            </div>

            <div class="api-section">
              <h3>Methods</h3>
              <type-doc kind="method" data-method="{{ $element }}">
                {{ partial "cem/type-doc-dsd.html" . }}
                <p>Loading methods...</p>
              </type-doc>
            </div>

            <div class="api-section">
              <h3>Events</h3>
              <type-doc kind="event" data-event="{{ $element }}">
                {{ partial "cem/type-doc-dsd.html" . }}
                <p>Loading events...</p>
              </type-doc>
            </div>

            <div class="api-section">
              <h3>CSS Custom Properties</h3>
              <css-value-doc package="{{ $package }}"
                             element="{{ $element }}">
                <p>Loading CSS properties...</p>
              </css-value-doc>
            </div>

            <div class="api-section">
              <h3>Slots</h3>
              <type-doc kind="slot" data-slot="{{ $element }}">
                {{ partial "cem/type-doc-dsd.html" . }}
                <p>Loading slots...</p>
              </type-doc>
            </div>
          </div>
        {{ end }}

      {{ else }}
        <!-- Package Overview -->
        <div class="package-overview">
          <h2>{{ $package | title }} API Reference</h2>
          <json-viewer package="{{ $package }}">
            <p>Loading API documentation...</p>
          </json-viewer>
        </div>
      {{ end }}
    </div>

  {{ else if eq $type "interface" }}
    <!-- Interface Documentation -->
    <div class="interface-docs">
      <h2>{{ .Get "name" }} Interface</h2>
      <type-doc kind="interface" data-interface="{{ .Get "name" }}">
        {{ partial "cem/type-doc-dsd.html" . }}
        <p>Loading interface documentation...</p>
      </type-doc>
    </div>

  {{ else if eq $type "class" }}
    <!-- Class Documentation -->
    <div class="class-docs">
      <h2>{{ .Get "name" }} Class</h2>
      <type-doc kind="class" data-class="{{ .Get "name" }}">
        {{ partial "cem/type-doc-dsd.html" . }}
        <p>Loading class documentation...</p>
      </type-doc>
    </div>

  {{ else if eq $type "function" }}
    <!-- Function Documentation -->
    <div class="function-docs">
      <h2>{{ .Get "name" }}()</h2>
      <type-doc kind="function" data-function="{{ .Get "name" }}">
        {{ partial "cem/type-doc-dsd.html" . }}
        <p>Loading function documentation...</p>
      </type-doc>
    </div>
  {{ end }}

</div>

<!-- Progressive Enhancement Script -->
<script type="module">
  document.addEventListener('DOMContentLoaded', () => {
    // Import API documentation components
    import('/_merged_assets/_static/custom-elements-manifest/type-doc.js');
    import('/_merged_assets/_static/custom-elements-manifest/css-value-doc.js');
    import('/_merged_assets/_static/custom-elements-manifest/json-viewer.js');
  });
</script>
