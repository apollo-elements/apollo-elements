{{- $playgroundId := .Get "id" -}}
{{- $lang := .Get "lang" -}}

{{- /* Process children first to populate scratch */ -}}
{{- $inner := .Inner -}}

{{- /* Get preview content from scratch (set by first playground-file) */ -}}
{{- $content := .Page.Scratch.Get (printf "playground-%s-preview" $playgroundId) -}}

<docs-playground id="{{ $playgroundId }}">
  <template shadowrootmode="open">
    <style>
      :host {
        display: block;
        box-sizing: border-box;
        position: relative;
        width: 100%;
        height: auto;
      }

      playground-ide {
        display: none;
        border: 0;
        overflow: hidden;

        --playground-code-font-family: monospace;
        --playground-code-font-size: 14px;
        --playground-border: none;
      }

      #snippet,
      playground-ide {
        width: 100%;
        height: 100%;
        border-radius: var(--playground-snippet-border-radius, 6px);
      }

      #snippet {
        display: block;
        box-sizing: border-box;
      }

      #snippet,
      button {
        border: 1px solid var(--playground-snippet-border-color, transparent);
        transition: border-color 0.2s ease-in-out;
        will-change: border-color;
      }

      :host([show]) playground-ide {
        display: flex;
        width: var(--playground-ide-width, 100%);
        height: var(--playground-ide-height, 600px);
      }

      button {
        background: var(--playground-snippet-button-background);
        border-end-end-radius: 6px;
        border-start-start-radius: 6px;
        color: inherit;
        cursor: pointer;
        display: block;
        font-size: 16px;
        outline: none;
        padding: 9px 16px;
        position: absolute;
        bottom: 0;
        right: -2px;
        transition:
          border-color 0.2s ease-in-out,
          background 0.1s ease,
          color 0.1s ease;
      }

      button:focus,
      button:hover {
        color: var(--playground-snippet-button-focus-color, var(--code-button-focus-color));
        background: var(--playground-snippet-button-focus-background, var(--code-button-focus-background));
        border-bottom-color: var(--playground-snippet-button-focus-background, var(--code-button-focus-background)) !important;
        border-right-color: var(--playground-snippet-button-focus-background, var(--code-button-focus-background)) !important;
      }

      :host([show]) #snippet,
      :host([show]) button {
        display: none;
      }

      :host(:not([show]):focus-within) #snippet,
      :host(:not([show]):hover) #snippet {
        border-color: var(--playground-snippet-focus-border-color, black);
      }

      :host(:not([show]):focus-within) button,
      :host(:not([show]):hover) button {
        border-top-color: var(--playground-snippet-focus-border-color, black);
        border-left-color: var(--playground-snippet-focus-border-color, black);
        border-bottom-color: var(--playground-snippet-outer-background-color, var(--page-background));
        border-right-color: var(--playground-snippet-outer-background-color, var(--page-background));
      }

      #snippet ::slotted(pre) {
        margin-bottom: 0 !important;
      }

      :host([loading]) #edit,
      #loading {
        display: none;
      }

      :host([loading]) #loading {
        display: inline-block;
      }
    </style>

    <div id="snippet"><slot></slot></div>

    <playground-ide part="playground-ide" exportparts="lhs,rhs"></playground-ide>

    <button part="button">
      <span id="edit">▶️ Edit Live</span>

      <slot name="loader">
        <!-- By Sam Herbert (@sherb), for everyone. More @ http://goo.gl/7AJzbL -->
        <svg id="loading" width="90" height="20" viewBox="0 0 120 30" xmlns="http://www.w3.org/2000/svg" fill="var(--primary-text-color)">
            <circle cx="15" cy="15" r="15">
                <animate attributeName="r" from="15" to="15"
                         begin="0s" dur="0.8s"
                         values="15;9;15" calcMode="linear"
                         repeatCount="indefinite" />
                <animate attributeName="fill-opacity" from="1" to="1"
                         begin="0s" dur="0.8s"
                         values="1;.5;1" calcMode="linear"
                         repeatCount="indefinite" />
            </circle>
            <circle cx="60" cy="15" r="9" fill-opacity="0.3">
                <animate attributeName="r" from="9" to="9"
                         begin="0s" dur="0.8s"
                         values="9;15;9" calcMode="linear"
                         repeatCount="indefinite" />
                <animate attributeName="fill-opacity" from="0.5" to="0.5"
                         begin="0s" dur="0.8s"
                         values=".5;1;.5" calcMode="linear"
                         repeatCount="indefinite" />
            </circle>
            <circle cx="105" cy="15" r="15">
                <animate attributeName="r" from="15" to="15"
                         begin="0s" dur="0.8s"
                         values="15;9;15" calcMode="linear"
                         repeatCount="indefinite" />
                <animate attributeName="fill-opacity" from="1" to="1"
                         begin="0s" dur="0.8s"
                         values="1;.5;1" calcMode="linear"
                         repeatCount="indefinite" />
            </circle>
        </svg>
      </slot>
    </button>
  </template>
  {{- highlight ($content | htmlUnescape) $lang "linenos=false" | safeHTML -}}
{{- .Inner -}}
</docs-playground>
