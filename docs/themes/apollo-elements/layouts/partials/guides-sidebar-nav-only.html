<!-- Guides Navigation (Mobile) -->
<nav class="sidebar-nav" aria-label="Guides Navigation">
  {{ $currentPage := . }}
  {{ $guidesSection := .Site.GetPage "/guides" }}

  {{ if $guidesSection }}
    <ul class="sidebar-menu">
      {{ range $guidesSection.Sections.ByWeight }}
        {{ $section := . }}
        <li class="sidebar-item {{ if or ($currentPage.IsDescendant .) ($currentPage.Eq .) }}active{{ end }}">
          <a href="{{ .RelPermalink }}" class="sidebar-link {{ if $currentPage.Eq . }}current{{ end }}">
            {{ .Title }}
          </a>

          <!-- ToC for current section page -->
          {{ if and ($currentPage.Eq .) $currentPage.TableOfContents }}
            <div class="sidebar-toc-inline">
              <h4 class="sidebar-toc-title">On This Page</h4>
              {{ $currentPage.TableOfContents }}
            </div>
          {{ end }}

          <!-- Subsections and pages -->
          {{ if or .Sections .RegularPages }}
            <ul class="sidebar-submenu">
              <!-- Direct pages of this section -->
              {{ range .RegularPages.ByWeight }}
                <li class="sidebar-subitem">
                  <a href="{{ .RelPermalink }}" class="sidebar-sublink {{ if $currentPage.Eq . }}current{{ end }}">
                    {{ .Title }}
                  </a>

                  <!-- ToC for current regular page -->
                  {{ if and ($currentPage.Eq .) $currentPage.TableOfContents }}
                    <div class="sidebar-toc-inline">
                      <h4 class="sidebar-toc-title">On This Page</h4>
                      {{ $currentPage.TableOfContents }}
                    </div>
                  {{ end }}
                </li>
              {{ end }}

              <!-- Subsections -->
              {{ range .Sections.ByWeight }}
                <li class="sidebar-subitem {{ if or ($currentPage.IsDescendant .) ($currentPage.Eq .) }}active{{ end }}">
                  <a href="{{ .RelPermalink }}" class="sidebar-sublink {{ if $currentPage.Eq . }}current{{ end }}">
                    {{ .Title }}
                  </a>

                  <!-- ToC for current subsection page -->
                  {{ if and ($currentPage.Eq .) $currentPage.TableOfContents }}
                    <div class="sidebar-toc-inline">
                      <h4 class="sidebar-toc-title">On This Page</h4>
                      {{ $currentPage.TableOfContents }}
                    </div>
                  {{ end }}

                  <!-- Third level pages and sections - only show for current section -->
                  {{ if or .RegularPages .Sections }}
                    {{ if or ($currentPage.IsDescendant .) ($currentPage.Eq .) }}
                      <ul class="sidebar-tertiary">
                        {{ range .RegularPages.ByWeight }}
                          <li class="sidebar-tertiary-item">
                            <a href="{{ .RelPermalink }}" class="sidebar-tertiary-link {{ if $currentPage.Eq . }}current{{ end }}">
                              {{ .Title }}
                            </a>
                          </li>
                        {{ end }}
                        {{ range .Sections.ByWeight }}
                          <li class="sidebar-tertiary-item">
                            <a href="{{ .RelPermalink }}" class="sidebar-tertiary-link {{ if $currentPage.Eq . }}current{{ end }}">
                              {{ .Title }}
                            </a>

                            <!-- ToC for current third-level section page -->
                            {{ if and ($currentPage.Eq .) $currentPage.TableOfContents }}
                              <div class="sidebar-toc-inline">
                                <h4 class="sidebar-toc-title">On This Page</h4>
                                {{ $currentPage.TableOfContents }}
                              </div>
                            {{ end }}
                          </li>
                        {{ end }}
                      </ul>
                    {{ end }}
                  {{ end }}
                </li>
              {{ end }}
            </ul>
          {{ end }}
        </li>
      {{ end }}
    </ul>
  {{ end }}
</nav>
